(()=>{"use strict";const e="pokedexRecentsList";function o(){try{const o=localStorage.getItem(e);return o?JSON.parse(o):[]}catch(e){return console.error("Erro ao recuperar lista de recentes do localStorage:",e),[]}}const t="https://pokeapi.co/api/v2";const n=document.getElementById("pokemon-card-display"),a=document.getElementById("pokemon-nome"),r=document.getElementById("pokemon-id"),s=document.getElementById("pokemon-imagem"),i=document.getElementById("pokemon-tipo"),c=document.getElementById("pokemon-som-btn"),l=document.getElementById("hp-valor"),d=document.getElementById("ataque-valor"),m=document.getElementById("defesa-valor"),u=document.getElementById("velocidade-valor"),p=document.getElementById("habilidade-1"),v=document.getElementById("habilidade-2"),g=document.getElementById("loading-overlay"),f=document.getElementById("lista-evolucoes"),E=document.getElementById("lista-pokemon-nav"),y=document.getElementById("busca-form"),h=document.getElementById("busca-input");let C=null;function x(e){return g&&n?e?(g.classList.add("visivel"),n.classList.add("carregando"),a&&(a.textContent=""),r&&(r.textContent=""),new Promise(e=>{setTimeout(e,300)})):(g.classList.remove("visivel"),void n.classList.remove("carregando")):(console.warn("Elementos de Loading não encontrados no DOM."),e?Promise.resolve():void 0)}function k(e){if(!document.querySelector)return void console.error("querySelector não suportado ou não disponível.");const o=document.querySelector(".listagem .ativo");o&&o.classList.remove("ativo"),e&&document.body.contains(e)&&e.classList.add("ativo")}function w(e){E?(E.innerHTML="",e.forEach(e=>{const o=document.createElement("li");o.className="pokemon",o.id=e,o.innerHTML=`<span>${e}</span>`,E.appendChild(o)})):console.error("Elemento da lista de navegação (lista-pokemon-nav) não encontrado!")}function L(e){if(!f)return void console.error("Elemento da lista de evoluções (lista-evolucoes) não encontrado!");f.innerHTML="";let o="";if(e&&0!==e.length?1===e.length&&(o="Não possui evoluções"):o="Evolução indisponível",o){const e=document.createElement("li");e.textContent=o,e.style.fontWeight="normal",e.style.color="#888",e.style.textAlign="left",e.style.marginBottom="0",e.classList.add("no-evolution"),f.appendChild(e)}else e.forEach(e=>{const o=document.createElement("li"),t=`#${e.id.toString().padStart(3,"0")}`;o.innerHTML=`\n                ${e.name}\n                <span class="evolution-id">${t}</span>\n            `,f.appendChild(o)})}function I(e){const o=document.getElementById("pokemon-geracao"),t=document.getElementById("pokemon-lendario-status"),n=document.getElementById("pokemon-descricao");if(!o||!t||!n)return console.error("Erro em renderSpeciesData: Elementos da UI (geracao, lendario, descricao) não encontrados no DOM!"),o&&(o.textContent="Erro"),t&&(t.textContent=""),void(n&&(n.textContent="Erro ao carregar descrição."));if(!e)return o.textContent="N/A",t.textContent="",t.className="lendario-status",void(n.textContent="Descrição não disponível.");o.textContent={"generation-i":"Kanto","generation-ii":"Johto","generation-iii":"Hoenn","generation-iv":"Sinnoh","generation-v":"Unova","generation-vi":"Kalos","generation-vii":"Alola","generation-viii":"Galar","generation-ix":"Paldea"}[e.generation.name]||e.generation.name,t.textContent="",t.className="lendario-status",e.is_legendary?(t.textContent="Lendário",t.classList.add("lendario")):e.is_mythical&&(t.textContent="Mítico",t.classList.add("mitico"));const a=e.flavor_text_entries.find(e=>"pt"===e.language.name),r=e.flavor_text_entries.find(e=>"en"===e.language.name);n.textContent=(a||r)?.flavor_text.replace(/[\n\f\r]/g," ")||"Descrição não disponível."}async function b(g){if(g){await x(!0);try{const f=await async function(e){const o=`${t}/pokemon/${String(e).toLowerCase()}`;try{const e=await fetch(o);if(!e.ok)throw new Error("Pokémon não encontrado");return await e.json()}catch(o){throw console.error(`Erro ao buscar dados do Pokémon "${e}":`,o),o}}(g),{speciesData:E,evolutionArray:y}=await async function(e){let o=null;try{const n=`${t}/pokemon-species/${e}/`,a=await fetch(n);if(!a.ok)return console.warn(`Espécie do Pokémon ${e} não encontrada. Dados de espécie e evolução não serão carregados.`),{speciesData:null,evolutionArray:[]};if(o=await a.json(),!o.evolution_chain?.url)return console.warn(`Pokémon ${e} (${o.name}) não possui URL de cadeia de evolução.`),{speciesData:o,evolutionArray:[{name:o.name,id:e}]};const r=o.evolution_chain.url,s=await fetch(r);return s.ok?{speciesData:o,evolutionArray:function(e){const o=[];let t=e;const n=e=>{const o=e.split("/");return parseInt(o[o.length-2],10)};do{const e=t.species.name,a=n(t.species.url);o.push({name:e,id:a}),t=t.evolves_to[0]}while(t&&t.hasOwnProperty("evolves_to"));return o}((await s.json()).chain)}:(console.warn(`Cadeia de evolução para ${e} não encontrada na URL: ${r}`),{speciesData:o,evolutionArray:[{name:o.name,id:e}]})}catch(o){return console.error(`Erro ao buscar dados da espécie/evolução para ID ${e}:`,o),{speciesData:null,evolutionArray:[]}}}(f.id);!function(t){if(t&&"string"==typeof t)try{let n=o();n=n.filter(e=>e!==t),n.unshift(t),n.length>6&&n.pop(),localStorage.setItem(e,JSON.stringify(n))}catch(e){console.error(`Erro ao adicionar "${t}" aos recentes:`,e)}else console.warn("Tentativa de adicionar nome de Pokémon inválido aos recentes:",t)}(f.name),w(o()),await async function(e){if(!(n&&a&&r&&s&&i))return console.error("Erro Crítico: Elementos principais do card não encontrados no DOM!"),Promise.reject(new Error("Elementos do card faltando no DOM"));a.textContent=e.name,r.textContent=`#${e.id.toString().padStart(3,"0")}`,s.alt=e.name;const o=o=>{const t=e.stats.find(e=>e.stat.name===o);return t?t.base_stat:"0"};l&&(l.textContent=o("hp")),d&&(d.textContent=o("attack")),m&&(m.textContent=o("defense")),u&&(u.textContent=o("speed"));const t=e.abilities.map(e=>e.ability.name);p&&(p.textContent=t[0]||"---"),v&&(v.textContent=t[1]||"---");const g=e.types[0].type.name;i.textContent=g,n.className=`cartao-pokemon tipo-${g} aberto`;const f=e.cries?.latest||e.cries?.legacy;return f&&c?(C=new Audio(f),c.classList.remove("escondido")):(C=null,c&&c.classList.add("escondido")),new Promise(o=>{const t=e.sprites?.other?.["official-artwork"]?.front_default,n=e.sprites?.front_default,a=()=>{n?(s.src=n,s.classList.add("mostrando-sprite"),s.onload=()=>o(),s.onerror=()=>{s.src="",s.classList.remove("mostrando-sprite"),o()}):(s.src="",s.classList.remove("mostrando-sprite"),o())};t?(s.src=t,s.classList.remove("mostrando-sprite"),s.onload=()=>o(),s.onerror=a):a()})}(f),L(y),I(E),k(document.getElementById(f.name))}catch(e){console.error("Erro no fluxo principal buscarEExibirPokemon:",e.message),e.message,n&&a&&r&&i&&s&&c&&l&&d&&m&&u&&p&&v?(n.className="cartao-pokemon tipo-unknown aberto",a.textContent="Não Encontrado",r.textContent="#???",i.textContent="error",s.src="",s.alt="Pokémon não encontrado",s.classList.remove("mostrando-sprite"),c.classList.add("escondido"),C=null,l.textContent="-",d.textContent="-",m.textContent="-",u.textContent="-",p.textContent="---",v.textContent="---",I(null),L([])):console.error("Erro em renderError: Elementos essenciais da UI não foram encontrados no DOM! Não é possível renderizar o estado de erro."),k(null)}finally{x(!1)}}else console.warn("buscarEExibirPokemon chamado sem um identificador.")}c?c.addEventListener("click",()=>{C&&(C.currentTime=0,C.play().catch(e=>console.error("Erro ao tentar tocar o áudio:",e)))}):console.warn("Elemento do botão de som (pokemon-som-btn) não encontrado no DOM. O som não funcionará."),E?E.addEventListener("click",e=>{const o=e.target.closest(".pokemon");o&&b(o.id)}):console.error("Erro Crítico: Container da lista de navegação (lista-pokemon-nav) não encontrado. Cliques na lista não funcionarão."),y&&h?y.addEventListener("submit",e=>{e.preventDefault();const o=h.value.trim().toLowerCase();o&&(b(o),h.value="")}):console.error("Erro Crítico: Formulário de busca (busca-form) ou input (busca-input) não encontrado. A busca não funcionará."),function(){const e=o(),t=e.length>0?e:["pikachu","bulbasaur","charmander","gyarados","gengar","dragonite"];w(t),t.length>0?b(t[0]):console.warn("Nenhum Pokémon inicial para carregar.")}()})();